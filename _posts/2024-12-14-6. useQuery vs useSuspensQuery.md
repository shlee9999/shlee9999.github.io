---
layout: post
title: "6. useQuery vs useSuspensQuery (React Query v5)"
categories: ["React", "React Query"]
tags: ["useQuery", "useSuspenseQuery"]

---

íƒœê·¸: ë„ì 

ë¦¬ì•¡íŠ¸ ê°œë°œìë¼ë©´ ìì£¼ ì‚¬ìš©í•˜ëŠ” @tanstack/react-query ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ useQueryì™€ useSuspenseQueryì˜ ì°¨ì´ì ì— ëŒ€í•´ ì´ ê¸€ì—ì„œ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•´ë³´ê³ ì í•©ë‹ˆë‹¤.

[ê³µì‹ë¬¸ì„œ ë§í¬](https://tanstack.com/query/v5/docs/framework/react/reference/useSuspenseQuery)

## useSuspenseQueryëŠ” ë¬´ì—‡ì´ë©° ì™œ íƒ„ìƒí•˜ê²Œ ë˜ì—ˆëŠ”ê°€?

useQueryëŠ” ë¡œë”© ìƒíƒœë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ ë•Œë¬¸ì— Reactì˜ Suspenseì™€ ì™„ë²½í•˜ê²Œ í˜¸í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ Suspenseì™€ ë” ë‚˜ì€ í˜¸í™˜ì„±ì„ ë³´ì—¬ì£¼ëŠ” useSuspenseQueryê°€ íƒ„ìƒí•©ë‹ˆë‹¤. SuspenseëŠ” ì´ˆê¸° ë°ì´í„° ë¡œë”© ìƒíƒœë¥¼ **`ì„ ì–¸ì `**ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ì–´, ê°œë°œìê°€ ë¡œë”© ìƒíƒœ ì²˜ë¦¬ì˜ ì„¸ë¶€ êµ¬í˜„ë³´ë‹¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

React Query v5ì—ì„œ ë‚˜ì˜¨ ìµœì‹  ë¬¸ë²•ì´ë©°, ì´ì „ ë²„ì „(v4 ì´í•˜)ì—ì„œëŠ” useQueryì˜ suspense ì˜µì…˜ì„ trueë¡œ ì„¤ì •í•´ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

![{8BF2DC2D-0BDD-40E8-B2B9-6587D63FBBE2}.png](../assets/img/2024-12-14-6.%20useQuery%20vs%20useSuspensQuery%20(React%20Query%20v5)/v5.png)

## Status ë¹„êµ

useQueryëŠ” data ìƒíƒœì— ë”°ë¼ `pending`, `success`, `error` 3ê°€ì§€ statusë¥¼ ê°€ì§‘ë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-12-12 á„‹á…©á„’á…® 4.51.13.png](../assets/img/2024-12-14-6.%20useQuery%20vs%20useSuspensQuery%20(React%20Query%20v5)/status.png)

ë°˜ë©´ useSuspenseQueryì—ëŠ” dataê°€ í•­ìƒ ì¡´ì¬í•œë‹¤ê³  ê°„ì£¼í•˜ì—¬ `success` ìƒíƒœë§Œ ì¡´ì¬í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ useSuspenseQueryë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” í•­ìƒ `Suspense`ì™€ `ErrorBoundary`ë¡œ ê°ì‹¸ì£¼ì–´ ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœì¼ ë•Œ ë„ì›Œì¤„ UIë¥¼ ëª…ì‹œí•´ì•¼ ì•ˆì •ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.

## ê¸°ë³¸ í˜•íƒœ ë¹„êµ

### useQuery ê¸°ë³¸ í˜•íƒœ

```tsx
import { useQuery } from '@tanstack/react-query';
import { fetchJsonPlaceholder } from '../apis/fetchJsonPlaceholder';

export default function UseQuery() {
  const { data, isPending, isError } = useQuery({
    queryKey: ['useQueryKey'],
    queryFn: fetchJsonPlaceholder,
  });

  if (isPending) return <div>isPending...</div>;
  if (isError) return <div>Error fetching data with useQuery!</div>;
  return (
    <div>
      <p>data fetched by "useQuery" : {JSON.stringify(data)}</p>
    </div>
  );
}
```

ìœ„ì²˜ëŸ¼ `isPending`, `isError`  ìƒíƒœ ì²˜ë¦¬ë¥¼ í†µí•´ fallbackì„ ë Œë”ë§í•˜ê²Œ ë˜ë©´ ì»´í¬ë„ŒíŠ¸ ìì²´ì— ì§‘ì¤‘ì„ í•˜ê¸° ì–´ë µë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

> TypeScript - `isPending`, `isError`ë¥¼ í†µí•œ early returnìœ¼ë¡œ dataì˜ `type narrowingì´ ê°€ëŠ¥`í•©ë‹ˆë‹¤.
> 

### useSuspense ê¸°ë³¸ í˜•íƒœ

```tsx
import { useSuspenseQuery } from '@tanstack/react-query';
import { fetchJsonPlaceholder } from '../apis/fetchJsonPlaceholder';

export default function UseSuspenseQuery() {
  const { data } = useSuspenseQuery({
    queryKey: ['useSuspenseQueryKey'],
    queryFn: fetchJsonPlaceholder,
  });

  return (
    <div>
      <p>data fetched by "useSuspenseQuery" : {JSON.stringify(data)}</p>
    </div>
  );
}
```

ìƒíƒœì²˜ë¦¬ ì—†ì´ ë°”ë¡œ ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UIë¥¼ ì‘ì„±í•˜ë©´ ë˜ë¯€ë¡œ ì»´í¬ë„ŒíŠ¸ ìì²´ì— ì§‘ì¤‘ì„ í•˜ê¸° ì¢‹ê³  ë¡œì§ì´ ê°„ê²°í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ `Suspense`ì™€ `ErrorBoundary`ë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

## í•¨ê»˜ ì¨ì„œ ë¹„êµí•´ë³´ê¸°

```tsx
// App.tsx
import { Suspense } from 'react';
import UseQuery from './components/UseQuery';
import { ErrorBoundary } from 'react-error-boundary';
import UseSuspenseQuery from './components/UseSuspenseQuery';

function App() {
  return (
    <div>
      <UseQuery />
      <ErrorBoundary FallbackComponent={ErrorFallback}>
        <Suspense fallback={<div>UseSuspenseQuery Loading...</div>}>
          <UseSuspenseQuery />
        </Suspense>
      </ErrorBoundary>
    </div>
  );
}

function ErrorFallback() {
  return <div>Error!!</div>;
}

export default App;
```

ìœ„ì™€ ê°™ì´ ë‘ ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë‘  ë Œë”ë§ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì•ì„œ ë§ì”€ë“œë ¸ë“¯ì´ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ useSuspenseQueryë¥¼ ì‚¬ìš©í•œ ì»´í¬ë„ŒíŠ¸ëŠ” `Suspense`ì™€ `ErrorBoundary`ë¡œ ê°ì‹¸ì£¼ì—ˆìŠµë‹ˆë‹¤.

### No Error

![á„‘á…§á†«á„Œá…µá†¸á„‹á…ªá†«á„…á…­.mov](../assets/img/2024-12-14-6.%20useQuery%20vs%20useSuspensQuery%20(React%20Query%20v5)/no_error.gif)

### Error

![á„’á…ªá„†á…§á†« á„€á…µá„…á…©á†¨ 2024-12-13 á„‹á…©á„Œá…¥á†« 12.34.18.gif](../assets/img/2024-12-14-6.%20useQuery%20vs%20useSuspensQuery%20(React%20Query%20v5)/error.gif)

ë‘ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ ì˜ë„í•œ ëŒ€ë¡œ ì˜ ì‘ë™í•˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## options

useQueryì™€ useSuspenseëŠ” ëŒ€ë¶€ë¶„ì˜ ì˜µì…˜ì„ ê³µìœ í•˜ì§€ë§Œ, useSuspenseì˜ ê²½ìš° ë‹¤ìŒ 3ê°€ì§€ ì˜µì…˜ë“¤ì´ ì œì™¸ë©ë‹ˆë‹¤. 

- `throwOnError`
- `enabled`
- `placeholderData`

## queryOptions

queryOptions í•¨ìˆ˜ë¥¼ `@tanstack/react-query`ì—ì„œ ì§€ì›í•©ë‹ˆë‹¤. typescriptì—ì„œ queryOptionsë¥¼ ë¶„ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ íƒ€ì…ì— ëŒ€í•œ íŒíŠ¸ë¥¼ ì œê³µí•´ì£¼ê¸° ìœ„í•˜ì—¬ ì¡´ì¬í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.

```jsx
const options = queryOptions({
  queryKey: ['useQueryKey'],
  queryFn: fetchJsonPlaceholder,
});

const { data, isPending, isError } = useQuery(options);
```

![{83F27BE9-D506-4AB9-BEDC-08C2308E3D46}.png](../assets/img/2024-12-14-6.%20useQuery%20vs%20useSuspensQuery%20(React%20Query%20v5)/queryOptions.png)

## ë§ˆì¹˜ë©°

useSuspenseQueryì˜ ì¡´ì¬ëŠ” ì•Œê³  ìˆì—ˆìœ¼ë‚˜ ì§€ì‹ì´ ë¶€ì¡±í•´ useQuery ì»´í¬ë„ŒíŠ¸ë¥¼ Suspenseë¡œ ê°ì‹¸ë†“ê³  ì •ìƒì ìœ¼ë¡œ fallbackì´ ë„ì›Œì§€ì§€ ì•Šì•„ í•œì°¸ì„ ê³ ë¯¼í–ˆë˜ ì ì´ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì´ìƒí–ˆë˜ ì ì€, ì»´í¬ë„ŒíŠ¸ì—ì„œ useQueryë¥¼ ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ í•œ ë²ˆ ë” ê°ì‹¸ë‹ˆ Suspenseê°€ ê°ì§€ë¥¼ ëª»í•˜ê³  ì§ì ‘ ì‚¬ìš©í•˜ë©´ ê°ì§€ê°€ ëì—ˆì–´ìš”.  useQueryê°€ Suspense ì™„ë²½í•˜ê²Œ í˜¸í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì´ ë•Œ ëª¸ì†Œ ëŠê¼ˆìŠµë‹ˆë‹¤. useSuspenseQueryë¥¼ ì´ë•Œ ê³µë¶€í•´ë³´ê²Œ ë˜ì—ˆê³  useQueryì™€ì˜ ëª…í™•í•œ ì°¨ì´ë¥¼ ì¸ì§€í•˜ëŠ” ê³„ê¸°ê°€ ë˜ì–´ ëˆ„êµ°ê°€ì—ê²Œ ë„ì›€ì´ ë˜ê³ ì ì´ ê¸€ì„ ì‘ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë‘ì„œì—†ëŠ” ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ˜€